<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DarkroomJS</title>
  <link rel="stylesheet" href="./libs/darkroom/darkroom.css">
  <link rel="stylesheet" href="./css/page.css">
</head>
<body>
  <div id="content">
    <div class="container">
      <section class="copy">
        <div class="figure-wrapper">
          <figure class="image-container target">
            <img src="" crossorigin='anonymous' alt="" id="target">

          </figure>
        </div>

      </section>
    </div>
  </div>

  <script src="./libs/fabric/fabric.js"></script>
  <script src="./libs/darkroom/darkroom.js"></script>

  <script>
function convertImgToDataURLviaCanvas(url, callback){
    var img = new Image();
    img.crossOrigin = 'Anonymous';
    img.onload = function(){
        var canvas = document.createElement('CANVAS');
        var ctx = canvas.getContext('2d');
        canvas.height = this.height;
        canvas.width = this.width;
        var compositeOperation = ctx.globalCompositeOperation;
        ctx.globalCompositeOperation = "destination-over";
        ctx.fillStyle = "rgba(0,0,0,0)";
        ctx.drawImage(this, 0, 0);
        var dataURL = canvas.toDataURL("png");
        callback(dataURL);
        canvas = null; 
    };
    img.src = url;
}

 var url = window.location.hash.replace("#","");
 document.getElementById("target").src = url;
 setTimeout("sstart()", 300);
 function sstart(){
    var dkrm = new Darkroom('#target', {
      // Size options
      minWidth: 200,
      minHeight: 200,
      maxWidth: window.innerWidth*.9,
      maxHeight: window.innerHeight*.9,
     // ratio: 4/3,
      backgroundColor: 'transparent',

      // Plugins options
      plugins: {
        save: false,
        crop: {
          quickCropKey: 67, //key "c"
          minHeight: 50,
          minWidth: 50,
          //ratio: 4/3
        }
      },

      // Post initialize script
      initialize: function() {
        sessionStorage.setItem("ie-data",dkrm.canvas.toDataURL());
        var cropPlugin = this.plugins['crop'];
        // cropPlugin.selectZone(170, 25, 300, 300);
        //cropPlugin.requireFocus();
        this.addEventListener('core:transformation', function() { 
           sessionStorage.setItem("ie-data",dkrm.canvas.toDataURL());
           sessionStorage.setItem("ie-smp", "true");
        });
      }
    });
                      }

  </script>

</body>
</html>
